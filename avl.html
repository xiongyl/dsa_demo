<html>
<head>   
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />   
<title>AVL tree demo</title>   
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" /> 
<link href="css/avl.css" rel="stylesheet"/>
</head>

<body>
<div id="input" align="center">
<h1>AVL tree demo</h1>
<select id="svgnum">
	<option>1</option>
	<option selected>2</option>
	<option>3</option>
	<option>4</option>
</select>
<label> step(s) in screen</label>
<p>
<button id="history">History</button>
<input id="num" type="text" maxlength="100" autocomplete="off"></input>
<button id="random" onclick="$('#num')[0].value = Math.ceil(Math.random() * 100)">Random</button>
<button id="insert">Insert</button>
<button id="delete">Delete</button>
<button id="find">Find</button>
<button id="clear">Clear</button>
</p>
</div>
<p></p>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/d3.v3.min.js"></script>
<script type="text/javascript" src="js/avl.js"></script>
<script type="text/javascript" src="js/draw.js"></script>
<script type="text/javascript">
	var drawy = 50;
	var initRandomSize = 10;
	var randomSize = Math.ceil(initRandomSize / $("#svgnum")[0].value);
	var avltree, choose, drawroot, history, svg, svgnum;
	var divsvg = [];
	start();
	
	function func(op) {
		$("#svgnum")[0].value = svgnum;
		var input = $("#num").val();
		$("#num")[0].value = "";
		if (op == "Clear") input = "23";// specific for clear
		if (input == null) return;
		input = input.split(" ");
		var opRecord = op + ": ";
		var empty = true;
		for (var i = 0; i < input.length; ++i) {
			var num = parseInt(input[i]);
			if (!isNaN(num)) {
				if (op == "Insert") avltree.insert(num);
				if (op == "Delete") avltree.remove(num);
				if (op == "Find") avltree.find(num);
				if (op == "Clear") avltree.deleteAll();
				opRecord += num + " ";
				empty = false;
				break;//comment this to make it available to deal with many numbers once
			}
		}
		if (empty) {
			return;
		}
		if (drawroot[choose] != null) {
			drawroot[choose].remove();
		}
		drawroot[choose] = genDrawingTree(avltree.root);
		if (drawroot[choose] != null) {
			drawroot[choose].draw(svg[choose], document.body.clientWidth / svgnum * 0.5, drawy);
		}
		$('#process' + choose).html(avltree.process);
		choose = (choose + 1) % svgnum;
		history += opRecord + "\n";
	}
	
	$("#insert").click(function() {
		func("Insert");
	})

	$("#delete").click(function() {
		func("Delete");
	})
	
	$("#find").click(function() {
		func("Find");
	})
	
	$("#clear").click(function() {
		func("Clear");
	})

	function genDrawingTree(node) {
		if (node == null) return null;
		var left = genDrawingTree(node.left);
		var right = genDrawingTree(node.right);
		var root = new Node(node.value);
		if (left != null) root.appendleft(left);
		if (right != null) root.appendright(right);
		return root;
	}

	function randomData() {
		var output = "Insert: ";
		for (var i = 0; i < randomSize; ++i) {
			var num = Math.ceil(Math.random() * 100);
			avltree.insert(num);
			output += num + " ";
		}
		if (drawroot[choose] != null) {
			drawroot[choose].remove();
		}
		drawroot[choose] = genDrawingTree(avltree.root);
		if (drawroot[choose] != null) {
			drawroot[choose].draw(svg[choose], document.body.clientWidth / svgnum * 0.5, drawy);
		}
		divsvg[choose].getElementsByTagName('p')[0].textContent = output;
		choose = (choose + 1) % svgnum;
		history += output + "\n";
	};
	
	function start() {
		svgnum = $('#svgnum').val();
		for (var i = 0; i < divsvg.length; ++i) {
			divsvg[i].remove();
		}
		for (var i = 0; i < svgnum; ++i) {
			$('body').append('<div class="divsvg" id="divsvg' + i + '"align="center"></div>');
		}
		divsvg = $('.divsvg');
		var styleWidth = "50%"
		switch(svgnum) {
			case "1": styleWidth = "100%"; break;
			case "3": styleWidth = "33%"; break;
			case "4": styleWidth = "25%"; break;
			case "5": styleWidth = "20%"; break;
		}
		avltree = Avl();
		choose = 0;
		drawroot = [];
		svg = [];
		history = "";
		for (var i = 0; i < divsvg.length; ++i) {
			divsvg[i].style.width = styleWidth;
			svg.push(d3.select('#divsvg'+i).append('svg'));
			$('#divsvg'+i).append('<p class="process" id="process' + i + '"></p>');
		}
		randomSize = Math.ceil(initRandomSize / svgnum);
		randomData();
	}
	
	$("#svgnum").change(start);
	
	$("#history").click(function() {
		alert(history);
	});
</script>
</body>
</html>